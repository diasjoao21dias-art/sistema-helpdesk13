{% extends "base.html" %}
{% block content %}
<h3>Todos os Chamados</h3>
<div class="table-responsive">
<table class="table table-striped align-middle">
  <thead>
    <tr>
      <th>ID</th>
      <th>Título</th>
      <th>Status</th>
      <th>Abertura</th>
      <th>Fechamento</th>
      <th>Criado por</th>
      <th>Fechado por</th>
      <th>Ações</th>
    </tr>
  </thead>
  <tbody>
  {% for c in chamados %}
    <tr>
      <td>{{ c.id }}</td>
      <td><a href="{{ url_for('detalhe_chamado', chamado_id=c.id) }}">{{ c.titulo }}</a></td>
      <td>
        {% if c.status == 'Aberto' %}
          <span class="badge bg-warning text-dark">Aberto</span>
        {% else %}
          <span class="badge bg-success">Fechado</span>
        {% endif %}
      </td>
      <td>{{ c.data_abertura.strftime('%d/%m/%Y %H:%M') if c.data_abertura else '' }}</td>
      <td>{{ c.data_fechamento.strftime('%d/%m/%Y %H:%M') if c.data_fechamento else '' }}</td>
      <td>{{ c.criador.username if c.criador else '' }}</td>
      <td>{{ c.fechador.username if c.fechador else '' }}</td>
      <td class="text-nowrap">
        {% if user.has_permission('edit_tickets') %}
        <a class="btn btn-sm btn-outline-primary" href="{{ url_for('editar_chamado', chamado_id=c.id) }}">Editar</a>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}
